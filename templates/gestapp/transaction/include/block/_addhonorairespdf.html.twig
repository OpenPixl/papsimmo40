{{ form_start(form) }}
{% if transaction.promisePdfFilename is null and transaction.dateAtPromise is null %}
    {% if 'ROLE_SUPER_ADMIN' in app.user.roles %}
        {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
        <td>
            <span id="rowEmptyPromisePdf">-</span>
            <div class="input-group w-100">
                {{ form_widget(form.honorairesPdfFilename, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
                <button class="btn btn-sm btn-secondary d-none" type="button" id="btnAddPromisePdf"><i class="fa-light fa-check"></i></button>
            </div>
        </td>
        <td>
            {{ form_widget(form.isSupprHonorairesPdf, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
        </td>
    {% else %}
        {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
        <td>
            <span id="rowEmptyPromisePdf">-</span>
            <div class="input-group w-100">
                {{ form_widget(form.honorairesPdfFilename, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
                <button class="btn btn-sm btn-secondary d-none" type="button" id="btnAddPromisePdf"><i class="fa-light fa-check"></i></button>
            </div>
        </td>
        <td>
            {{ form_widget(form.isSupprHonorairesPdf, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
        </td>
    {% endif %}
    {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
{% elseif transaction.promisePdfFilename is null and transaction.dateAtPromise is not null %}
    {% if 'ROLE_SUPER_ADMIN' in app.user.roles %}
        {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
        <td>
            <span id="rowEmptyPromisePdf">-</span>
            <div class="input-group w-100">
                {{ form_widget(form.honorairesPdfFilename, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
                <button class="btn btn-sm btn-secondary d-none" type="button" id="btnAddPromisePdf"><i class="fa-light fa-check"></i></button>
            </div>
        </td>
        <td>
            {{ form_widget(form.isSupprHonorairesPdf, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
        </td>
    {% else %}
        {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
        <td>
            <span id="rowEmptyPromisePdf">-</span>
            <div class="input-group w-100">
                {{ form_widget(form.honorairesPdfFilename, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
                <button class="btn btn-sm btn-secondary d-none" type="button" id="btnAddPromisePdf"><i class="fa-light fa-check"></i></button>
            </div>
        </td>
        <td>
            {{ form_widget(form.isSupprHonorairesPdf, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
        </td>
    {% endif %}
    {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
{% elseif transaction.promisePdfFilename is not null and transaction.dateAtPromise is not null %}
    {# Dans ce cas, le fichier est présent et une date de promesse est présente en BDD #}
    {% if 'ROLE_SUPER_ADMIN' in app.user.roles and transaction.isValidPromisepdf == 0 %}
        {% if 'ROLE_SUPER_ADMIN' in app.user.roles %}
            {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
            <td>
                <span id="rowEmptyPromisePdf">-</span>
                <div class="input-group w-100">
                    {{ form_widget(form.honorairesPdfFilename, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
                    <button class="btn btn-sm btn-secondary d-none" type="button" id="btnAddPromisePdf"><i class="fa-light fa-check"></i></button>
                </div>
            </td>
            <td>
                {{ form_widget(form.isSupprHonorairesPdf, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
            </td>
        {% else %}
            {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
            <td>
                <span id="rowEmptyPromisePdf">-</span>
                <div class="input-group w-100">
                    {{ form_widget(form.honorairesPdfFilename, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
                    <button class="btn btn-sm btn-secondary d-none" type="button" id="btnAddPromisePdf"><i class="fa-light fa-check"></i></button>
                </div>
            </td>
            <td>
                {{ form_widget(form.isSupprHonorairesPdf, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
            </td>
        {% endif %}
        {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
    {% elseif 'ROLE_SUPER_ADMIN' in app.user.roles and transaction.isValidPromisepdf == 1 %}
        {# Affichage du l'input pdf uniquement pour le mandataire principal#}
        {% if transaction.addCollTransacs|length > 0%}
            {% for AddColl in transaction.addCollTransacs|filter(t => t.refEmployed.id == app.user.id ) %}
                <td>
                    <p class="alert alert-info mb-0 p-1">Honoraires déposés</p>
                    <div class="input-group w-100 d-none">
                        {{ form_widget(form.honorairesPdfFilename, {'attr': {'class':'form-control form-control-sm' }}) }}
                        {% if transaction.honorairesPdfFilename is not null %}
                            <button class="btn btn-sm btn-info" type="button" id="btnHonorairePdf"><i class="fa-light fa-arrows-rotate"></i></button>
                        {% else %}
                            <button class="btn btn-sm btn-success" type="button" id="btnHonorairePdf"><i class="fa-light fa-check"></i></button>
                        {% endif %}
                    </div>
                </td>
            {% endfor %}
        {% else %}
            <td>
                <div class="input-group w-100">
                    {{ form_widget(form.honorairesPdfFilename, {'attr': {'class':'form-control form-control-sm' }}) }}
                    {% if transaction.honorairesPdfFilename is not null %}
                        <button class="btn btn-sm btn-info" type="button" id="btnHonorairePdf"><i class="fa-light fa-arrows-rotate"></i></button>
                    {% else %}
                        <button class="btn btn-sm btn-success" type="button" id="btnHonorairePdf"><i class="fa-light fa-check"></i></button>
                    {% endif %}
                </div>
            </td>
        {% endif %}
        {% if transaction.honorairesPdfFilename is not null %}
            <td>
                {% set refyear = transaction.property.ref|split('/',2)|first %}
                {% set refnumber = transaction.property.ref|split('/',2)|last %}
                <button id="showPromise" type="button" class="btn btn-sm btn-secondary" data-bs-toggle="modal" data-bs-target="#modalhonoraires"><i class="fa-duotone fa-eye"></i> Voir le document</button>
                <a class="btn btn-sm btn-secondary" href="{{ asset('properties/'~ refyear ~'-'~ refnumber ~'/documents/' ~ transaction.honorairesPdfFilename) }}" download="{{ transaction.honorairesPdfFilename }}"><i class="fa-duotone fa-download"></i></a>
                <!-- Modal -->
                <div class="modal fade" id="modalhonoraires" tabindex="-1" aria-labelledby="modalPromise" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Facture d'honoraires</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body" style="padding: 0;">

                                <div id="externaFile">
                                    <iframe src="{{ asset('properties/'~ refyear ~'-'~ refnumber ~'/documents/' ~ transaction.honorairesPdfFilename) }}" width="100%" height="500px"></iframe>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Fermer</button>
                            </div>
                        </div>
                    </div>
                </div>
            </td>
            <td>
                {% if transaction.addCollTransacs|length > 0%}
                {% else %}
                    <a class="btn btn-sm btn-secondary supprDocument" href="{{ path('op_gestapp_transaction_deldocument', {'id': transaction.id, 'name':transaction.honorairesPdfFilename}) }}" ><i class="fa-duotone fa-trash"></i></a>
                {% endif %}
                <div class="form-check d-none">
                    {{ form_widget(form.isSupprHonorairesPdf, {'attr': {'class':'form-check-input'}}) }}
                    <label class="form-check-label" for="flexCheckDefault21">
                        Supprimer
                    </label>
                </div>
            </td>
        {% else %}
            <td colspan="2">
                <p class="mb-0">Un document doit être déposé.</p>
                <div class="form-check d-none">
                    {{ form_widget(form.isSupprHonorairesPdf, {'attr': {'class':'form-check-input'}}) }}
                    <label class="form-check-label" for="flexCheckDefault21">
                        Supprimer
                    </label>
                </div>
            </td>
        {% endif %}
    {% endif %}
    {% if 'ROLE_EMPLOYED' in app.user.roles and transaction.isValidPromisepdf == 0 and transaction.honorairesPdfFilename is null%}
        {% if 'ROLE_SUPER_ADMIN' in app.user.roles %}
            {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
            <td>
                <span id="rowEmptyPromisePdf">-</span>
                <div class="input-group w-100">
                    {{ form_widget(form.honorairesPdfFilename, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
                    <button class="btn btn-sm btn-secondary d-none" type="button" id="btnAddPromisePdf"><i class="fa-light fa-check"></i></button>
                </div>
            </td>
            <td>
                {{ form_widget(form.isSupprHonorairesPdf, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
            </td>
        {% else %}
            {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
            <td>
                <span id="rowEmptyPromisePdf">-</span>
                <div class="input-group w-100">
                    {{ form_widget(form.honorairesPdfFilename, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
                    <button class="btn btn-sm btn-secondary d-none" type="button" id="btnAddPromisePdf"><i class="fa-light fa-check"></i></button>
                </div>
            </td>
            <td>
                {{ form_widget(form.isSupprHonorairesPdf, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
            </td>
        {% endif %}
        {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
    {% elseif 'ROLE_EMPLOYED' in app.user.roles and transaction.isValidPromisepdf == 1 and transaction.honorairesPdfFilename is null %}
        {% if 'ROLE_SUPER_ADMIN' in app.user.roles %}
            {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
            <td>
                <span id="rowEmptyPromisePdf">-</span>
                <div class="input-group w-100">
                    {{ form_widget(form.honorairesPdfFilename, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
                    <button class="btn btn-sm btn-secondary d-none" type="button" id="btnAddPromisePdf"><i class="fa-light fa-check"></i></button>
                </div>
            </td>
            <td>
                {{ form_widget(form.isSupprHonorairesPdf, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
            </td>
        {% else %}
            {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
            <td>
                <span id="rowEmptyPromisePdf">-</span>
                <div class="input-group w-100">
                    {{ form_widget(form.honorairesPdfFilename, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
                    <button class="btn btn-sm btn-secondary d-none" type="button" id="btnAddPromisePdf"><i class="fa-light fa-check"></i></button>
                </div>
            </td>
            <td>
                {{ form_widget(form.isSupprHonorairesPdf, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
            </td>
        {% endif %}
        {# Il n'y a pas de promesse de vente et pas de date de signature enregistrée en BDD #}
    {% elseif 'ROLE_EMPLOYED' in app.user.roles and transaction.isValidPromisepdf == 1 and transaction.honorairesPdfFilename is not null %}
        <td>
            <div class="input-group w-100">
                Une facture d'honoraire ({{ transaction.honorairesPdfFilename }}) a été déposée.
                <div class="input-group w-100">
                    {{ form_widget(form.honorairesPdfFilename, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
                    <button class="btn btn-sm btn-secondary d-none" type="button" id="btnAddPromisePdf"><i class="fa-light fa-check"></i></button>
                </div>
                {{ form_widget(form.isSupprHonorairesPdf, {'attr': {'class':'form-control form-control-sm d-none'}}) }}
            </div>
        </td>
        <td>
            {% set refyear = transaction.property.ref|split('/',2)|first %}
            {% set refnumber = transaction.property.ref|split('/',2)|last %}
            <button id="showPromise" type="button" class="btn btn-sm btn-secondary" data-bs-toggle="modal" data-bs-target="#modalhonoraires"><i class="fa-duotone fa-eye"></i> Voir le document</button>
            <a class="btn btn-sm btn-secondary" href="{{ asset('properties/'~ refyear ~'-'~ refnumber ~'/documents/' ~ transaction.honorairesPdfFilename) }}" download="{{ transaction.honorairesPdfFilename }}"><i class="fa-duotone fa-download"></i></a>
            <!-- Modal -->
            <div class="modal fade" id="modalhonoraires" tabindex="-1" aria-labelledby="modalPromise" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Promesse de vente</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" style="padding: 0;">

                            <div id="externaFile">
                                <iframe src="{{ asset('properties/'~ refyear ~'-'~ refnumber ~'/documents/' ~ transaction.honorairesPdfFilename) }}" width="100%" height="500px"></iframe>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Fermer</button>
                        </div>
                    </div>
                </div>
            </div>
        </td>
    {% endif %}
{% endif %}
{{ form_end(form) }}