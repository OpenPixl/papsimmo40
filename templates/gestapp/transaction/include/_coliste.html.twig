
<table class="table">
    <thead>
    <tr>
        <th class="col-1"></th>
        <th class="col-1">N°</th>
        <th class="col-2">Collaborateur</th>
        <th class="col-1">Etat</th>
        <th></th>
        <th class="col-2">actions</th>
    </tr>
    </thead>
    <tbody>
        {% for listtransac in listtransacs|filter(t => t.refColl == app.user.id )|filter( t => t.isClosedfolder == 0 ) %}
            <tr class="align-middle
                {% if listtransac.dateAtPromise is defined and listtransac.isValidPromisepdf == 0 %}table-light{% endif %}
                {% if listtransac.isValidPromisepdf == 1 and listtransac.dateAtSale is defined and listtransac.isValidActepdf == 0 %}table-light{% endif %}
            ">
                <td>
                    {{ render(controller('App\\Controller\\Gestapp\\PhotoController::includeinlistproperty', {'idproperty': listtransac.property})) }}
                </td>
                <td class="align-left">
                    <b>{{ listtransac.name }}</b>
                    {% if listtransac.dateAtPromise is defined and listtransac.isValidPromisepdf == 0 %}<br><span class="text-danger">Nouveau fichier déposé :<br>La promesse de vente doit être controlée.</span>{% endif %}<br>
                    {% if listtransac.isValidPromisepdf == 1 and listtransac.dateAtSale is defined and listtransac.isValidActepdf == 0 %}<br><span class="text-danger">Nouveau fichier déposé :<br>L'attestation de l'acte de vente doit être controlée.</span>{% endif %}
                </td>
                <td>
                    {% if listtransac.avatarName is not null %}
                        <img class="rounded-circle" src="{{ asset('images/avatar/' ~ listtransac.avatarName) }}" alt="{{ listtransac.avatarName }}" style="height:50px;width:50px">
                        {{ listtransac.firstName }} {{ listtransac.lastName }}
                    {% else %}
                        <img class="rounded-circle" src="{{ asset('images/jpeg/user.jpg') }}" alt="" style="height:50px;width:50px">
                    {% endif %}
                </td>
                <td>
                    {% set progress = 0 %}
                    {% if listtransac.state == 'open' %}
                        {% set progress = 20 %}
                    {% elseif listtransac.state == 'promise' %}
                        {% set progress = 40 %}
                    {% elseif listtransac.state == 'quotation' %}
                        {% set progress = 60 %}
                    {% elseif listtransac.state == 'definitive_sale' %}
                        {% set progress = 80 %}
                    {% elseif listtransac.state == 'finished' %}
                        {% set progress = 100 %}
                    {% endif %}
                    <div class="progress">
                        <div class="progress-bar bg-info" role="progressbar" style="width: {{ progress }}%" aria-valuenow="{{ progress }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                <td>
                    {% if progress >= 75 %}
                        <p class="alert alert-info mb-0">Le dossier est complet. Vous pouvez déposé votre facture.
                            <a href="{{ path('op_gestapp_transaction_addcollaborator_addinvoice', {'refEmployed': app.user.id,'idTransac': listtransac.idTransac}) }}" class="modalInvoice" data-bs-whatever="EDIT-Dépôt de votre facture-{{ listtransac.id }}"><i class="fa-thin fa-file-arrow-down"></i> Dépot</a>
                        </p>
                    {% else %}
                        <p class="alert alert-secondary mb-0">Le dossier est en cours de construction. Il ne vous est pas possible d'ajouter votre facture pour l'instant.</p>
                    {% endif %}
                </td>
                <td>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-dark dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Action
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ path('op_gestapp_transaction_show2', {'id': listtransac.idTransac}) }}">Voir</a></li>
                            <li><a id="btnModaltransaction" class="dropdown-item" href="{{ path('op_gestapp_transaction_del', {'id': listtransac.idTransac}) }}" data-bs-toggle="modal" data-bs-target="#modaltransaction" data-bs-whatever="{{ listtransac.idTransac }}">Supprimer</a></li>
                            {% if is_granted('ROLE_SUPER_ADMIN') %}
                            <li><a href="{{ path('op_gestapp_transaction_closedfolder', {'id': listtransac.idTransac}) }}" class="dropdown-item transClosed">Clôture du dossier</a></li>
                            {% endif %}
                        </ul>
                    </div>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="5">Il n'y a pas de vente en cours actuellement.</td>
            </tr>
        {% endfor %}
    </tbody>
</table>